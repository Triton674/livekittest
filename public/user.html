<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>LiveKit 2 Participants Test</title>
  <style>
    #transcript { white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: auto; }
    audio { display: block; margin-top: 5px; }
    .participant { font-weight: bold; }
  </style>
</head>
<body>
  <h1>LiveKit 2 Participants Demo</h1>
<button id="joinParticipant">Rejoindre la room</button>
<script type="module">
import { Room } from "https://unpkg.com/livekit-client/dist/livekit-client.esm.mjs"
let room
document.getElementById("joinParticipant").onclick = async () => {
  const res = await fetch("https://livekit-production-34a9.up.railway.app/token?role=participant")
  const { token, url } = await res.json()
  room = new Room()
  await room.connect(url, token)
  await room.localParticipant.setMicrophoneEnabled(true)

  room.on("trackSubscribed", track => {
    if(track.kind === "audio") {
      const audio = document.createElement("audio")
      audio.srcObject = new MediaStream([track.mediaStreamTrack])
      audio.autoplay = true
      document.body.appendChild(audio)
    }
  })

  document.getElementById("joinParticipant").disabled = true
}
</script>


</body>
</html>