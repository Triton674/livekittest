<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>LiveKit 2 Participants Test</title>
  <style>
    #transcript { white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: auto; }
    audio { display: block; margin-top: 5px; }
    .participant { font-weight: bold; }
  </style>
</head>
<body>
  <h1>LiveKit 2 Participants Demo</h1>
<button id="joinAdmin">Lancer la room (Admin)</button>
<button id="stopAdmin" disabled>Stop Session</button>
<div id="transcript"></div>
<script type="module">
 import { Room } from "https://unpkg.com/livekit-client/dist/livekit-client.esm.mjs";

let room;

document.getElementById("joinAdmin").onclick = async () => {
  try {
    // Appel à ton backend pour récupérer le token
    const res = await fetch("/token?role=admin"); // localhost:3000/token ou déployé
    const data = await res.json();

    const { token, url, room: roomName } = data;

    // Connexion à LiveKit
    room = new Room();

    await room.connect(url, token);
    await room.localParticipant.setMicrophoneEnabled(true);

    document.getElementById("joinAdmin").disabled = true;
    document.getElementById("stopAdmin").disabled = false;

    console.log(`Connecté au room ${roomName} avec identity ${data.identity}`);

    // Ici tu peux lancer la transcription ou l'enregistrement
    // startTranscription();
    // startRecording();
  } catch (err) {
    console.error("Erreur connexion LiveKit:", err);
    alert("Impossible de se connecter au serveur LiveKit");
  }
};

</script>

</body>
</html>